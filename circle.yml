machine:
  services:
    - docker
  python:
    version: 2.7

dependencies:
  cache_directories:
    - "~/docker"
  override:
    - mkdir -p ~/docker
    - if [ ! -e ~/docker/hbase.tar ]; then docker build -t "dhardy92/hbase" . && docker save "dhardy92/hbase" > ~/docker/hbase.tar; else docker load -i ~/docker/hbase.tar; fi
    - pip install pyvows tornado_pyvows happybase thumbor coverage

test:
  override:
    - docker run -d -p 9090:9090 "dhardy92/hbase"; sleep 15
    - pyvows -c -l thumbor_hbase
    - debuild -i -us -uc -b && dpkg -c ../python-thumbor-hbase_*_*.deb
  post:
    - mv ../python-thumbor-hbase_*.{deb,cache} $CIRCLE_ARTIFACTS
